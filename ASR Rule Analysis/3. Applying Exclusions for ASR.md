## Applying ASR Rule Exclusions

Attack Surface Reduction rules are intentionally aggressive by design. Exclusions must be treated as precise exceptions, not broad allow lists. The objective is to preserve legitimate business workflows without weakening protection against living off the land techniques and abuse of trusted processes. Poorly scoped exclusions expand the attack surface and undermine the purpose of ASR. This guidance explains how ASR evaluates behavior, how exclusions are applied, and how to scope exclusions safely using observed telemetry and practical field experience.

## How ASR Evaluates Activity

ASR rules are behavior based, not file based. When a rule triggers, Microsoft Defender evaluates the event using a simple model: who did what to what.

- The initiating process is the executable responsible for the action. This may be an Office application, a script host such as `powershell.exe` or `wscript.exe`, a service, or a vendor supplied executable.
- The behavior is the specific action being blocked, such as file or directory writes, child process creation, process injection, Win32 API calls, or registry modification.
- The target is the destination object involved in the action, such as a file, folder, registry key, or memory region.

ASR exclusions are evaluated against the initiating process, not the destination object. Excluding the file or folder being written to rarely prevents the rule from firing because the behavior is still executed by the same initiating process.

## Exclusion Targeting Strategy

ASR exclusions should almost always target the process performing the blocked action. The most reliable and defensible approach is to exclude the full executable path of the initiating process observed in ASR audit or block telemetry.

- File level exclusions are strongly preferred. They are more precise, easier to validate in telemetry, and significantly reduce unintended exposure compared to folder level exclusions.
- Always start with the full path to the executable before considering broader scope.

Folder level exclusions should be considered exceptional and only used when all of the following are true:

- The application dynamically spawns or updates binaries
- Subfolders are vendor controlled and versioned
- The behavior is consistent and repeatable
- The activity has been validated in ASR audit telemetry

Even in these cases, folder exclusions should be narrowly scoped and reviewed regularly.

## Operational Guidance

Exclusions should be driven by evidence, not assumptions. Validate the initiating process, the behavior, and its repeatability using Advanced Hunting or ASR audit mode before deploying exclusions broadly. Each exclusion represents a deliberate tradeoff between operational continuity and security posture and should be documented and justified accordingly.

## Wildcards (*) What Works and What Does Not

ASR path exclusions support simple wildcard matching using `*`.

- Wildcards are literal path matchers, not regular expressions.
- They do not evaluate intent, logic, or context.

Valid example:

`C:\Windows\SystemTemp\*`

This matches files directly under the `SystemTemp` directory. It does not infer behavior or traverse unrelated paths. Wildcards are evaluated against the literal resolved NTFS path of the initiating process.

Unsupported or unreliable wildcard usage includes:

- Wildcards that attempt to span multiple directory boundaries
- Wildcards used inside tenant branded or user scoped cloud sync folders
- Assumptions based on regular expression style logic

Unreliable example:

`C:\Users\*\OneDrive*\*`

OneDrive folder names are tenant branded and may vary by organization. Folder names may include spaces. ASR does not normalize these variations, and wildcard traversal across these dynamic paths is inconsistent. As a result, exclusions like this may silently fail and should be avoided.

## OneDrive Exclusions

ASR path exclusions can behave inconsistently when used against tenant branded OneDrive folders, especially when folder names contain spaces. Exclusions must resolve to absolute NTFS paths at runtime, and wildcard placement is critical. Broad exclusions of the OneDrive root materially weaken ASR protections.

Avoid exclusions such as:

`C:\Users\*\OneDrive*\*`

When exclusions are required to support legitimate workflows:

- Apply exclusions incrementally
- Validate behavior after each change using ASR audit or block telemetry
- Start with the most specific path possible
- Broaden only when required

Recommended patterns for investigation and testing:

`C:\Users\*\OneDrive*\Documents\Reports\Quarterly\*`  
`C:\Users\*\OneDrive*\Documents\Reports*\*`  
`C:\Users\*\OneDrive*\Documents\*.xlsx`  
`C:\Users\*\OneDrive*\*.xlsx`

Each pattern progressively expands scope. Stop once the required behavior is unblocked and avoid excluding the entire OneDrive tree.

## When to Exclude User Folders

User folder exclusions should be rare and only considered when all of the following are true:

- A business critical application executes from a user writable location
- The binary is signed and vendor managed
- ASR audit telemetry shows consistent legitimate behavior over time
- The exclusion can be narrowly scoped

Example of an acceptable vendor managed extraction path:

`C:\Users\<username>\AppData\Roaming\Vendor Software\Updater\extract\app-*\bin\tool.exe`

This pattern must never be generalized to broader paths such as `AppData\*`.

## System Folder Exclusion Examples

Examples:

`C:\Windows\System32\msiexec.exe`  
`C:\Windows\System32\conhost.exe`  
`C:\Windows\System32\svchost.exe`  
`C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe`  
`C:\Windows\Microsoft.NET\Framework64\v4.0.30319\csc.exe`  
`C:\Windows\Microsoft.NET\Framework64\v4.0.30319\cvtres.exe`

Do not exclude:

`C:\Windows\System32\*`

## File vs Folder vs Process What to Exclude

ASR Rule | Rule GUID | Scenario | Correct Exclusion Target | What to Exclude | What Not to Exclude
--- | --- | --- | --- | --- | ---
Block Win32 API calls from Office macros | d4f940ab-401b-4efc-aadc-ad5f3c50688a | Office macro writes files or calls system APIs | Initiating Office executable | Office application binary | Files, folders, or user profile paths
Block Office applications from creating child processes | 3b576869-a4ec-4529-8536-b80a7769e899 | Office launches a helper process | Initiating Office executable | Office application binary | Spawned executable or Program Files
Block Office applications from injecting code | 75668c1f-73b5-4cf0-bb93-3ecf5cb7cc84 | Office injects into a process | Initiating Office executable | Office application binary | Target injected process
Block Office applications from creating executable content | 92e97fa1-2edf-4476-bdd6-9dd0b4dddc7b | Office writes executables | Initiating Office executable | Office application binary | Destination folder
Block executable content from email client and webmail | be9ba2d9-53ea-4cdc-84e5-9b1eeee46550 | Email launches executable content | Email client executable | Email client process | Download paths
Block JavaScript or VBScript from launching downloaded executables | d3e037e1-3eb8-44c8-a917-57927947596d | Script launches payload | Script host executable | Script engine | Payload file path
Block scripts from executing malicious content | 5beb7efe-fd9a-4556-801d-275e5ffc04cc | Script executes payload | Script host executable | Script engine | Payload location
Block process creation from PSExec and WMI | d1e49aac-8f56-4280-b9ba-993a6d77406c | Remote execution | Admin tool executable | Approved admin tool | Spawned processes
Block persistence through WMI | e6db77e5-3df2-4cf1-b95a-636979351e5b | Registers persistence | Application executable | Registering process | WMI paths
Block persistence through registry run keys | c1db55ab-c21a-4637-bb3f-a12568109d35 | Adds autorun | Application executable | Modifying process | Registry paths
Block abused signed drivers | 56a863a9-875e-4185-98a7-b882c64b5ce5 | Loads vulnerable driver | Loader executable | Loader process | Driver directories
Block credential stealing from LSASS | 9e6c4e1f-7d60-472f-ba1a-a39ef669e4b2 | LSASS access | Security tool executable | Vendor documented binary | LSASS.exe
Block unsigned executables from USB | b2b3f03d-6a65-4f7b-a9c7-1c7ef74a9ba4 | Runs from USB | Executable binary | Trusted binary | USB root
Block low prevalence executables | 01443614-cd74-433a-b99e-2ecdc07bfc25 | New executable blocked | Executable binary | Validated binary | Entire folders
