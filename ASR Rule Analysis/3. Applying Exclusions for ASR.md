## Applying Exclusions for ASR Rules -- Under Review

Attack Surface Reduction (ASR) rules are intentionally aggressive. Exclusions must be treated as surgical exceptions, not broad allow lists.

The goal is to preserve legitimate business workflows without weakening protection against living off the land attacks.

This document outlines best practices, risk tradeoffs, wildcard behavior, and real world exclusion examples based on observed ASR telemetry and Microsoft guidance.

ASR exclusions should almost always target the process or file performing the malicious action, not the file or folder being written to.


## How ASR Evaluates Behavior

ASR rules are behavior based, not file based.

When an ASR rule fires, Defender evaluates:

WHO did WHAT to WHAT

Who  
The initiating process such as an executable, script host, Office application, or service.

What  
The behavior being blocked such as file write, process injection, Win32 API call, or child process creation.

What (target)  
The destination file, directory, registry key, or memory region.

ASR exclusions are evaluated against the initiating process, not the destination object.


## Core Principles for ASR Exclusions

Prefer file level exclusions over folder level exclusions.

Always start with the full executable path.  
File level exclusions are more precise and significantly reduce attack surface.

Folder level exclusions should only be used when all of the following are true:
- The application dynamically spawns binaries
- The vendor version controls subfolders
- The behavior is consistent, repeatable, and validated in audit telemetry


## Wildcards (*) – What Works and What Doesn’t

Wildcards are literal path wildcards, not regex.

Valid example:

    C:\Windows\SystemTemp\*

Wildcards do not perform logical matching and do not understand context.


### Not Supported or Unreliable

- Wildcards that cross folder boundaries
- Wildcards inside user profile paths with tenant branding
- Regex style or logical matching

Unreliable example:

    C:\Users\*\OneDrive*\*

Tenant branded OneDrive folders vary by organization and often include spaces.  
This causes exclusions to silently fail and should be avoided.


## When to Exclude User Folders or OneDrive

Only consider exclusions under user folders when all of the following conditions are met:
- A business critical application installs binaries under AppData
- The binary is signed and validated
- Audit telemetry shows consistent and legitimate behavior over time

Example of a narrow, vendor managed extraction path:

    C:\Users\<username>\AppData\Roaming\Fiery Software Manager\extract\fsm-*\FSM\curl.exe

This pattern is common for vendor managed self extracting tools and must never be generalized.


## Common ASR Exclusion Examples

The examples below reflect initiating processes commonly excluded after validation in ASR audit or block telemetry.  
These exclusions target the process performing the behavior, not the destination file or directory.

Office applications performing validated macro activity:

    C:\Program Files\Microsoft Office\root\Office16\EXCEL.EXE
    C:\Program Files\Microsoft Office\root\Office16\WINWORD.EXE

Script hosts performing approved automation:

    C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe
    C:\Windows\System32\cscript.exe
    C:\Windows\System32\wscript.exe

Vendor line of business applications spawning child processes:

    C:\Program Files\Vendor\App\vendorapp.exe
    C:\Program Files (x86)\Vendor\App\service.exe

Self updating or extracting vendor tools:

    C:\ProgramData\Vendor\Updater\updater.exe


## Key Takeaway

If an ASR alert states that a process attempted to perform a blocked behavior, the exclusion must reference that process.

Do not exclude the file being written.  
Do not exclude the destination directory.  
Exclude the initiating executable responsible for the behavior.
